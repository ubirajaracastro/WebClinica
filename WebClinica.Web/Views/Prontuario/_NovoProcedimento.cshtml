@model WebClinica.Web.Models.ProntuarioProcedimentoViewModel

@using (Html.BeginCollectionItem("Procedimentos"))
{
    <center>
        <div class="form-horizontal">
            @Html.ValidationSummary(true, "", new { @class = "text-danger" })

            <div class="form-group">
                <div class="row form-group">
                    <div class="col-md-2">
                       @Html.Label("Procedimento")
                    </div>

                    <div class="col-md-9">
                        @Html.EditorFor(model => model.CodigoProcedimento, new { htmlAttributes = new { @class = "form-control search" } })                       
                    </div>

                </div>
            </div>

        </div>
    </center>
}

<script>
$(function () {     
    pesquisaProcedimentosCBHMP();
    acharControleAdicionarEvento();
});


function pesquisaProcedimentosCBHMP(id) {
    $("#" + id).autocomplete({
        minLength: 3,
        source: function (request, response) {
            $.ajax({
                url: "/Procedimento/obterTabelaTUSS",
                type: "POST",
                dataType: "json",
                data: { parametro: request.term },
                success: function (data) {
                    response($.map(data, function (item) {
                        return { label: item.Codigo + '-' + item.Procedimento, value: item.Codigo };
                    }))

                }
            })
        },
        messages: {
            noResults: "", results: ""
        }
    });

}


function acharControleAdicionarEvento() {

    $.each($(".search"), function () {
        pesquisaProcedimentosCBHMP(this.id)       
    });
}


</script>


